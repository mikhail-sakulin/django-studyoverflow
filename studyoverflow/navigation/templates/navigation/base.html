{% load static %}
{% load navigation_tags %}
{% load notifications_tags %}


<!-- Базовый html-шаблон с header, не предназначен для использования без дочерних html-шаблонов -->
<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.75">

  <!-- Блок с названием страницы -->
  {% block title %}
  {% endblock %}

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">  <link type="text/css" rel="stylesheet" href="{% static 'navigation/css/base.css' %}">

  <link type="text/css" rel="stylesheet" href="{% static 'navigation/css/messages.css' %}">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

  <!-- Блок с загрузкой дополнительных css-стилей в дочерних html-шаблонах -->
  {% block extra_css %}
  {% endblock %}
</head>

<body class="bg-black">

  <!-- header -->
  <header id="header" class="p-3 bg-black text-white">
    <div class="container">
      <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-xl-start">

        <ul class="nav col-12 col-xl-auto me-xl-auto mb-2 justify-content-center mb-2 mb-xl-0 gap-1">
          <li><a id="studyoverflow-button" href="{% url 'home' %}" class="nav-link px-2 text-warning">StudyOverflow</a></li>
          {% get_menu_for_header as menu %}
          {% for element_of_menu in menu %}
            <li><a href="{% url element_of_menu.url %}"
                   class="{% if section_of_menu_selected == element_of_menu.url %}
                            nav-hover-selected
                          {% endif %}
                          nav-link nav-hover px-2 text-white">
                    {{ element_of_menu.name }}
                </a>
            </li>
          {% endfor %}
        </ul>

        <form method="GET" action="{% url 'posts:list' %}" class="col-12 col-xl-3 mb-3 mb-xl-0 me-xl-3">
          <input id="base-search" name="q" type="search" class="form-control form-control-dark" placeholder="Поиск по постам..." aria-label="Search">
        </form>

        <div class="text-end">
          {% if user.is_authenticated %}

            {% get_unread_notifications_count user as unread_notifications_count %}

            <a id="notifications-button"
               href="{% url 'notifications:base' %}"
               class="btn btn-outline-light border-0 align-items-center position-relative">

                <!-- Иконка уведомлений -->
                <i id="i-notifications" class="{% if unread_notifications_count > 0 %}bi bi-bell-fill{% else %}bi bi-bell{% endif %}"></i>

                <!-- Счётчик уведомлений -->
                <span id="notifications-count" class="{% if unread_notifications_count > 0 %}text-danger{% else %}text-warning{% endif %}" data-user-id="{{ user.id }}">
                    {{ unread_notifications_count }}
                </span>

                <div class="notification-particles"></div>
            </a>

            <a href="{% url 'users:my_profile' %}" id="profile-button" class="btn btn-warning me-2">
              <i id="profile-icon" class="bi bi-person-circle"></i>
              <span id="profile-icon-label">Профиль</span>
            </a>

            <form method="post" action="{% url 'users:logout' %}?next={{ request.path }}" class="d-inline">
                {% csrf_token %}
                 <button type="submit" class="btn btn-outline-light">
                   Выйти
                 </button>
            </form>

          {% else %}

            <a href="{% url 'users:login' %}?next={{ request.path }}" class="btn btn-outline-light me-2">Войти</a>
            <a href="{% url 'users:register' %}?next={{ request.path }}" class="btn btn-warning">Регистрация</a>

          {% endif %}
        </div>

      </div>
    </div>
  </header>

  <!-- Подключение html-шаблона для сообщений Django (messages) -->
  {% include 'navigation/messages.html' %}

  <!-- Блок с основным содержимым дочерних html-шаблонов -->
  {% block content  %}
  {% endblock %}

  <!-- Подключение JS-скрипта Bootstrap 5 -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Подключение JS-скрипта для управления отображением сообщений -->
  <script src="{% static 'navigation/js/messages.js' %}"></script>

  <script src="{% static 'notifications/js/websocket_notifications.js' %}"></script>

  <!-- Блок с загрузкой дополнительных js-файлов в дочерних html-шаблонах -->
  {% block extra_js %}
  {% endblock %}

</body>
</html>
