<div class="container px-4 px-lg-2 mt-4">
    <div id="filters-toggle" class="px-1 text-white mb-3">
        <span id="filters-toggle-text">Выбрать фильтрацию и сортировку</span>
        <span id="filters-toggle-icon">⮟</span>
    </div>
</div>

<form method="get" class="container px-4 px-lg-2
      {% if filter_form.errors %}filters-visible{% else %}filters-hidden{% endif %}"
      id="filters-form">

  <div class="px-1 mb-4 bg-black text-white rounded">

    <div class="row g-3 mb-3">
      <div class="col-12">
        <label class="form-label">Поиск в постах</label>
        <input type="text" name="q" class="form-control" value="{{ request.GET.q }}"
               placeholder="Текст в заголовке или содержимом...">
      </div>
    </div>

    <div class="row g-3">
      <div class="col-md-6 mb-2">
        <label class="form-label">Теги (вводятся через запятую)</label>

        <div class="d-flex align-items-center gap-3">
          <input type="text" id="id_tags" name="tags" class="form-control"
                 value="{{ request.GET.tags }}" placeholder="Введите теги...">

          <button id="toggle-tags" type="button" class="btn btn-outline-light btn-sm flex-shrink-0 shadow-none">
            Выбрать теги ▼
          </button>
        </div>

        <div id="tags-wrapper" class="mt-3">
          <input type="text" id="tag-search" class="form-control" placeholder="Поиск тегов...">

          <div id="tags-container" class="form-control">
            {% for tag in all_tags %}
              <div class="tag-item" data-tag="{{ tag }}">{{ tag }}</div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <label class="form-label">Автор</label>
        <input type="text" name="author" class="form-control" value="{{ request.GET.author }}"
               placeholder="Имя автора">
        {% if filter_form.author.errors %}
          <div class="text-danger mt-1">
            {% for error in filter_form.author.errors %}
              <div class="mt-1">
                {{ error }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>

    <div class="row g-3 mt-2">
      <div class="col-12">
        <label class="form-label me-4">Совпадение</label>

        <div class="btn-group">
          <input type="hidden" name="tag_match" id="tag_match_input"
                 value="{{ request.GET.tag_match }}">

          <button type="button"
                  class="btn btn-outline-light btn-sm tag-match-btn shadow-none {% if request.GET.tag_match == 'any' %}active{% endif %}"
                  data-value="any">
            Один тег
          </button>

          <button type="button"
                  class="btn btn-outline-light btn-sm tag-match-btn shadow-none {% if request.GET.tag_match == 'all' %}active{% endif %}"
                  data-value="all">
            Все теги
          </button>
        </div>
      </div>
    </div>

    <div class="row g-3 mt-1 mb-3">

      <div class="col-xl-6">
        <label class="form-label me-2">Комментарии</label>

        <div class="btn-group">
          <input type="hidden" name="has_comments" id="has_comments_input"
                 value="{{ request.GET.has_comments|default:'any' }}">

          <button type="button"
                  class="btn btn-outline-light btn-sm comment-btn shadow-none {% if request.GET.has_comments == 'any' or not request.GET.has_comments %}active{% endif %}"
                  data-value="any">
            Неважно
          </button>

          <button type="button"
                  class="btn btn-outline-light btn-sm comment-btn shadow-none {% if request.GET.has_comments == 'yes' %}active{% endif %}"
                  data-value="yes">
            Есть
          </button>

          <button type="button"
                  class="btn btn-outline-light btn-sm comment-btn shadow-none {% if request.GET.has_comments == 'no' %}active{% endif %}"
                  data-value="no">
            Нет
          </button>
        </div>
      </div>

      <div class="col-md-6">
        <div class="d-flex align-items-center">
          <label class="form-label mb-2 me-3">Сортировать по</label>

          <div class="btn-group">
            <input type="hidden" name="sort" id="sort_input" value="{{ request.GET.sort|default:'created' }}">

            <button type="button"
                    class="btn btn-outline-light btn-sm sort-btn shadow-none {% if request.GET.sort == 'created' or not request.GET.sort %}active{% endif %}"
                    data-value="created">
              Дата
            </button>

            <button type="button"
                    class="btn btn-outline-light btn-sm sort-btn shadow-none {% if request.GET.sort == 'likes' %}active{% endif %}"
                    data-value="likes">
              Лайки
            </button>

            <button type="button"
                    class="btn btn-outline-light btn-sm sort-btn shadow-none {% if request.GET.sort == 'comments' %}active{% endif %}"
                    data-value="comments">
              Комментарии
            </button>
          </div>

          <div class="ms-3 d-flex gap-1">
            <input type="hidden" name="order" id="order_input"
                   value="{{ request.GET.order|default:'desc' }}">

            <button type="button"
                    class="btn btn-link p-0 order-arrow-btn shadow-none {% if request.GET.order == 'desc' or not request.GET.order %}active{% endif %}"
                    data-value="desc">
              ↓
            </button>

            <button type="button"
                    class="btn btn-link p-0 order-arrow-btn shadow-none {% if request.GET.order == 'asc' %}active{% endif %}"
                    data-value="asc">
              ↑
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-between mt-4">
      <button class="btn btn-outline-warning btn-sm px-4">Применить</button>
      <a href="{% url 'posts:list' %}" class="btn btn-outline-light btn-sm px-4">Сбросить</a>
    </div>

  </div>
</form>
